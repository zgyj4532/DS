# 数据库表结构说明

本项目共创建了 **32 个数据表**，以下是每个表的详细字段说明：

**注意**：
- `order_split` 表已废弃，订单资金拆分记录统一使用 `account_flow` 表
- `user_addresses` 表已统一为 `addresses` 表
- `directors` 和 `director_dividends` 表已在 `database_setup.py` 中定义并会自动创建

---

## 1. users（用户表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `mobile` - VARCHAR(30) UNIQUE（手机号，唯一）
- `password_hash` - CHAR(60)（密码哈希）
- `name` - VARCHAR(100) NOT NULL（姓名）
- `email` - VARCHAR(100) UNIQUE（邮箱，唯一）
- `member_level` - TINYINT NOT NULL DEFAULT 0（会员等级）
- `points` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000 COMMENT '联创星级专用点数(用于计算总获得点数)'（联创星级专用点数，支持4位小数）
- `subsidy_points` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000 COMMENT '周补贴专用点数(用于计算总获得点数)'（周补贴专用点数，支持4位小数）
- `team_reward_points` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000 COMMENT '团队奖励专用点数(用于计算总获得点数)'（团队奖励专用点数，支持4位小数）
- `referral_points` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000 COMMENT '推荐奖励专用点数(用于计算总获得点数)'（推荐奖励专用点数，支持4位小数）
- `true_total_points` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000 COMMENT '联创星级、周补贴、团队奖励、推荐奖励点数真实总数，发放联创星级、周补贴、团队奖励、推荐奖励点数时会额外发放一份进入这里'（四个点数真实总数，支持4位小数）
- `promotion_balance` - DECIMAL(14,2) NOT NULL DEFAULT 0.00（推广余额）
- `member_points` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000（用户积分，支持4位小数）
- `merchant_points` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000（商家积分，支持4位小数）
- `merchant_balance` - DECIMAL(14,2) NOT NULL DEFAULT 0.00（商家余额）
- `status` - TINYINT NOT NULL DEFAULT 1（状态）
- `level_changed_at` - DATETIME NULL（等级变更时间）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）
- `referral_id` - BIGINT UNSIGNED NULL（推荐人id）
- `referral_code` - VARCHAR(6) NULL UNIQUE（推荐码，唯一）
- `withdrawable_balance` - DECIMAL(14,2) NOT NULL DEFAULT 0.00（可提现余额）
- `avatar_path` - VARCHAR(255) NULL DEFAULT NULL（头像路径）
- `is_merchant` - TINYINT(1) NOT NULL DEFAULT 0（判断是不是商家）
- `six_director` - INT NULL DEFAULT 0（直推六星人数，用于荣誉董事晋升判定）
- `six_team` - INT NULL DEFAULT 0（团队六星人数，用于荣誉董事晋升判定）
- `wechat_sub_mchid` - VARCHAR(32) NULL DEFAULT NULL（微信特约商户号，用于进件成功后的回写）

**索引：**
- `idx_mobile` (mobile)
- `idx_email` (email)
- `idx_member_level` (member_level)
- `idx_wechat_sub_mchid` (wechat_sub_mchid)

---

## 2. products（商品表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `name` - VARCHAR(255) NOT NULL（商品名称）
- `pinyin` - TEXT（拼音）
- `description` - TEXT（描述）
- `category` - VARCHAR(100)（分类）
- `main_image` - VARCHAR(500)（主图）
- `detail_images` - TEXT（详情图）
- `is_member_product` - TINYINT(1) NOT NULL DEFAULT 0（是否会员商品）
- `status` - TINYINT NOT NULL DEFAULT 0（状态）
- `user_id` - BIGINT UNSIGNED（用户ID）
- `buy_rule` - TEXT（购买规则）
- `freight` - DECIMAL(12,2) DEFAULT 0.00（运费）
<!-- ✅ 新增字段：积分抵扣上限（支持小数，精确到4位） -->
- `max_points_discount` - DECIMAL(12,4) DEFAULT NULL COMMENT '积分抵扣上限'
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**索引：**
- `idx_is_member_product` (is_member_product)
- `idx_user_id` (user_id)
- `idx_status` (status)
- `idx_category` (category)

---

## 3. orders（订单表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `order_number` - VARCHAR(50) UNIQUE（订单号，唯一）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `merchant_id` - BIGINT UNSIGNED NOT NULL DEFAULT 0（商家ID）
- `offline_order_flag` - TINYINT(1) NOT NULL DEFAULT 0（是否线下收银订单：0线上/1线下）
- `applyment_id` - BIGINT UNSIGNED DEFAULT NULL（关联微信进件单ID，线下订单必填）
- `total_amount` - DECIMAL(12,2) NOT NULL（总金额）
- `original_amount` - DECIMAL(12,2) DEFAULT 0.00（原始金额）
- `points_discount` - DECIMAL(12,4) NOT NULL DEFAULT 0.0000（积分抵扣，支持4位小数）
- `is_member_order` - TINYINT(1) NOT NULL DEFAULT 0（是否会员订单）
- `is_vip_item` - TINYINT(1) DEFAULT 0（是否含会员商品）
- `status` - VARCHAR(30) NOT NULL DEFAULT 'pending_pay'（订单状态）
- `refund_status` - VARCHAR(30) DEFAULT NULL（退款状态）
- `consignee_name` - VARCHAR(100)（收货人姓名）
- `consignee_phone` - VARCHAR(20)（收货人电话）
- `province` - VARCHAR(20) DEFAULT ''（省份）
- `city` - VARCHAR(20) DEFAULT ''（城市）
- `district` - VARCHAR(20) DEFAULT ''（区县）
- `shipping_address` - TEXT（收货地址）
- `pay_way` - ENUM('wechat') DEFAULT 'wechat'（支付方式）
- `refund_reason` - TEXT（退款原因）
- `auto_recv_time` - DATETIME NULL（自动收货时间）
- `tracking_number` - VARCHAR(64) NULL COMMENT '快递单号'（快递单号）
- `delivery_way` - VARCHAR(20) NOT NULL DEFAULT 'platform' COMMENT '配送方式：platform-平台配送/pickup-自提'（配送方式）
- `expire_at` - DATETIME NULL（订单过期时间，未支付订单7天后自动过期）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**索引：**
- `idx_user` (user_id)
- `idx_order_number` (order_number)
- `idx_created_at` (created_at)
- `idx_status` (status)
- `idx_expire_at` (expire_at)

**外键：**
- `orders_ibfk_1`: user_id → users(id)

---

## 4. order_items（订单明细表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `order_id` - BIGINT UNSIGNED NOT NULL（订单ID）
- `product_id` - BIGINT UNSIGNED NOT NULL（商品ID）
- `sku_id` - BIGINT UNSIGNED NULL（SKU ID，关联 product_skus.id）
- `quantity` - INT NOT NULL DEFAULT 1（数量）
- `unit_price` - DECIMAL(12,2) NOT NULL（单价）
- `total_price` - DECIMAL(12,2) NOT NULL（总价）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_order` (order_id)
- `idx_product` (product_id)

**外键：**
- `order_items_ibfk_1`: order_id → orders(id)
- `order_items_ibfk_2`: product_id → products(id)

---

## 5. finance_accounts（资金账户表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `account_name` - VARCHAR(100) NOT NULL（账户名称）
- `account_type` - VARCHAR(50) UNIQUE NOT NULL（账户类型，唯一）
- `balance` - DECIMAL(14,4) NOT NULL DEFAULT 0.0000（余额）
- `config_params` JSON DEFAULT NULL COMMENT （资金池配置参数）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**唯一键：**
- `uk_account_type` (account_type)

**初始化账户类型：**
- 周补贴池 (subsidy_pool)
- 公益基金 (public_welfare)
- 平台维护 (platform)
- 荣誉董事分红 (honor_director)
- 社区店 (community)
- 城市运营中心 (city_center)
- 大区分公司 (region_company)
- 事业发展基金 (development)
- 公司积分账户 (company_points)
- 公司余额账户 (company_balance)
- 平台收入池（会员商品）(platform_revenue_pool)
- 微信进件手续费 (wx_applyment_fee)

---

## 6. account_flow（账户流水表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `account_id` - BIGINT UNSIGNED（账户ID）
- `related_user` - BIGINT UNSIGNED（关联用户ID）
- `account_type` - VARCHAR(50)（账户类型）
- `change_amount` - DECIMAL(14,4) NOT NULL（变动金额）
- `balance_after` - DECIMAL(14,4)（变动后余额）
- `flow_type` - VARCHAR(50)（流水类型，如：income/expense）
- `remark` - VARCHAR(255)（备注，用于记录订单号等信息）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_account` (account_id)
- `idx_related_user` (related_user)
- `idx_created_at` (created_at)

**说明**：
- 此表统一记录所有资金流水，包括订单资金拆分、退款回冲、商家结算等
- 订单资金拆分记录通过 `remark` 字段记录订单号（格式：`订单分账: {order_number}`），`account_type` 区分商家和各个资金池
- 已废弃 `order_split` 表，所有订单资金拆分记录统一使用此表

**订单资金拆分使用的账户类型**：
- `merchant_balance` - 商家余额（订单金额的80%）
- `public_welfare` - 公益基金（平台20%的1%）
- `maintain_pool` - 平台维护（平台20%的1%）
- `subsidy_pool` - 周补贴池（平台20%的12%）
- `director_pool` - 荣誉董事分红（平台20%的2%）
- `shop_pool` - 社区店（平台20%的1%）
- `city_pool` - 城市运营中心（平台20%的1%）
- `branch_pool` - 大区分公司（平台20%的0.5%）
- `fund_pool` - 事业发展基金（平台20%的1.5%）

---

## 7. points_log（积分流水表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `change_amount` - DECIMAL(12,4) NOT NULL（变动积分，支持4位小数）
- `balance_after` - DECIMAL(12,4) NOT NULL（变动后积分，支持4位小数）
- `type` - ENUM('member','merchant') NOT NULL（积分类型：会员/商家）
- `reason` - VARCHAR(255)（变动原因）
- `related_order` - BIGINT UNSIGNED（关联订单ID）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user` (user_id)
- `idx_order` (related_order)

---

## 8. user_referrals（用户推荐关系表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED UNIQUE NOT NULL（用户ID，唯一）
- `referrer_id` - BIGINT UNSIGNED（推荐人ID）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_referrer` (referrer_id)

---

## 9. pending_rewards（待审核奖励表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `reward_type` - ENUM('referral','team') NOT NULL（奖励类型：推荐/团队）
- `amount` - DECIMAL(12,4) NOT NULL（奖励金额）
- `order_id` - BIGINT UNSIGNED NOT NULL（订单ID）
- `layer` - TINYINT DEFAULT NULL（层级）
- `status` - ENUM('pending','approved','rejected') DEFAULT 'pending'（状态）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user_status` (user_id, status)
- `idx_order_id` (order_id)
- `idx_status` (status)

---

## 10. coupons（优惠券表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `coupon_type` - ENUM('user','merchant') NOT NULL（优惠券类型：用户/商家）
- `amount` - DECIMAL(14,4) NOT NULL（优惠券金额，支持4位小数）
- `status` - ENUM('unused','used','expired') NOT NULL DEFAULT 'unused'（状态） 
- `applicable_product_type` - ENUM('all','normal_only','member_only') NOT NULL DEFAULT 'all'(优惠券适用商品范围：all=不限制，normal_only=仅普通商品，member_only=仅会员商品)
- `valid_from` - DATE NOT NULL（有效期开始）
- `valid_to` - DATE NOT NULL（有效期结束）
- `used_at` - DATETIME DEFAULT NULL（使用时间）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user_status` (user_id, status)
- `idx_valid_to` (valid_to)

---

## 11. withdrawals（提现表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `amount` - DECIMAL(14,4) NOT NULL（提现金额）
- `tax_amount` - DECIMAL(14,4) NOT NULL DEFAULT 0.00（税费）
- `actual_amount` - DECIMAL(14,4) NOT NULL DEFAULT 0.00（实际到账金额）
- `status` - VARCHAR(30) NOT NULL DEFAULT 'pending_auto'（状态）
- `audit_remark` - VARCHAR(255) DEFAULT NULL（审核备注）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `processed_at` - DATETIME DEFAULT NULL（处理时间）

**索引：**
- `idx_user_status` (user_id, status)

---

## 12. team_rewards（团队奖励表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `from_user_id` - BIGINT UNSIGNED NOT NULL（来源用户ID）
- `order_id` - BIGINT UNSIGNED（订单ID）
- `layer` - TINYINT NOT NULL（层级）
- `reward_amount` - DECIMAL(12,2) NOT NULL DEFAULT 0.00（奖励金额）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user_id` (user_id)
- `idx_from_user_id` (from_user_id)

---

## 13. weekly_subsidy_records（周补贴记录表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `week_start` - DATE NOT NULL（周开始日期）
- `subsidy_amount` - DECIMAL(14,4) NOT NULL（补贴金额，支持4位小数）
- `points_before` - DECIMAL(12,4) NOT NULL（补贴前积分，支持4位小数）
- `points_deducted` - DECIMAL(12,4) NOT NULL（扣除积分，支持4位小数）
- `coupon_id` - BIGINT UNSIGNED（关联优惠券ID）

**索引：**
- `idx_user_week` (user_id, week_start)

---

---

## 14. cart（购物车表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `product_id` - BIGINT UNSIGNED NOT NULL（商品ID）
- `sku_id` - BIGINT UNSIGNED NULL（SKU ID，关联 product_skus.id）
- `quantity` - INT DEFAULT 1（数量）
- `specifications` - JSON DEFAULT NULL（商品规格，如颜色、尺码等）
- `selected` - TINYINT DEFAULT 1（是否选中）
- `added_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（添加时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**唯一键：**
- `uk_user_product_sku` (user_id, product_id, sku_id)

**索引：**
- `idx_user_id` (user_id)
- `idx_product_id` (product_id)

**外键：**
- `cart_ibfk_1`: user_id → users(id)
- `cart_ibfk_2`: product_id → products(id)

---

## 15. refunds（退款表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `order_number` - VARCHAR(50) NOT NULL（订单号）
- `refund_type` - ENUM('return','refund_only') NOT NULL（退款类型：退货退款/仅退款）
- `reason` - TEXT NOT NULL（退款原因）
- `status` - ENUM('applied','seller_ok','success','rejected') DEFAULT 'applied'（状态）
- `reject_reason` - TEXT（拒绝原因）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**索引：**
- `idx_order_number` (order_number)

**外键：**
- `refunds_ibfk_1`: order_number → orders(order_number)

---

## 16. addresses（地址表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `name` - VARCHAR(100) NOT NULL（收货人姓名）
- `phone` - VARCHAR(20) NOT NULL（收货人电话）
- `province` - VARCHAR(20) NOT NULL DEFAULT ''（省份）
- `city` - VARCHAR(20) NOT NULL DEFAULT ''（城市）
- `district` - VARCHAR(20) NOT NULL DEFAULT ''（区县）
- `detail` - TEXT NOT NULL（详细地址）
- `is_default` - TINYINT(1) DEFAULT 0（是否默认地址）
- `addr_type` - ENUM('shipping','return') NOT NULL DEFAULT 'shipping'（地址类型：购物地址/退货地址）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**索引：**
- `idx_user` (user_id)
- `idx_user_default` (user_id, is_default)

**外键：**
- `addresses_ibfk_1`: user_id → users(id)

**说明**：
- 此表统一管理用户地址，包括购物地址和退货地址
- 已废弃 `user_addresses` 表，统一使用 `addresses` 表
- 订单系统和用户系统共享此表进行地址管理

---

## 17. merchant_statement（商家对账单表）

**字段列表：**
- `merchant_id` - BIGINT UNSIGNED NOT NULL（商家ID）
- `date` - DATE NOT NULL（日期）
- `opening_balance` - DECIMAL(10,2) NOT NULL（期初余额）
- `income` - DECIMAL(10,2) NOT NULL（收入）
- `withdraw` - DECIMAL(10,2) NOT NULL（提现）
- `closing_balance` - DECIMAL(10,2) NOT NULL（期末余额）

**主键：**
- PRIMARY KEY (merchant_id, date)

---

## 18. alert_order（订单预警表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `order_number` - VARCHAR(50) NOT NULL（订单号）
- `alert_type` - VARCHAR(50) NOT NULL（预警类型）
- `detail` - TEXT NOT NULL（详情）
- `is_handled` - TINYINT(1) DEFAULT 0（是否已处理）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

---

## 19. banner（轮播图表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `product_id` - BIGINT UNSIGNED NOT NULL（商品ID，外键→products.id）
- `image_url` - VARCHAR(500) NOT NULL（图片URL）
- `link_url` - VARCHAR(500) NULL（跳转链接）
- `sort_order` - INT NULL（排序值）
- `status` - INT NULL DEFAULT 1（状态：0隐藏/1显示）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_product_id` (product_id)

**外键：**
- `banner_ibfk_1`: product_id → products(id)

---

## 20. product_attributes（商品属性表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `product_id` - BIGINT UNSIGNED NOT NULL（商品ID，外键→products.id）
- `name` - VARCHAR(100) NOT NULL（属性名）
- `value` - VARCHAR(100) NOT NULL（属性值）

**索引：**
- `idx_product_id` (product_id)

**外键：**
- `product_attributes_ibfk_1`: product_id → products(id)

---

## 21. product_skus（商品SKU表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `product_id` - BIGINT UNSIGNED NOT NULL（商品ID，外键→products.id）
- `sku_code` - VARCHAR(64) NOT NULL UNIQUE（唯一SKU编码）
- `price` - DECIMAL(12,2) NULL COMMENT '商品现价（实际售价）'（售价）
<!-- ✅ 新增字段：商品原价（市场价/划线价） -->
- `original_price` - DECIMAL(12,2) NULL COMMENT '商品原价（市场价/划线价）'
- `stock` - INT NULL DEFAULT 0（库存数量）
- <!-- ✅ 新增字段：商品规格（存储颜色、尺码等） -->
- `specifications` - JSON DEFAULT NULL COMMENT '商品规格（如：{"颜色": "红色", "尺码": "XL"}）'
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**索引：**
- `idx_product_id` (product_id)

**外键：**
- `product_skus_ibfk_1`: product_id → products(id)

---

## 22. system_sentence（系统标语表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `banner_sentence` - VARCHAR(128) NULL（轮播图标语）
- `system_sentence` - VARCHAR(128) NULL（系统标语）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**说明：**
- 此表用于存储系统配置的标语信息，包括轮播图标语和系统标语

---

## 23. directors（荣誉董事表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL UNIQUE（用户ID，唯一）
- `status` - VARCHAR(20) NOT NULL DEFAULT 'active'（状态：active=活跃）
- `dividend_amount` - DECIMAL(14,2) NOT NULL DEFAULT 0.00（累计分红金额）
- `activated_at` - DATETIME NULL（激活时间）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user_id` (user_id)
- `idx_status` (status)

**说明：**
- 此表用于记录荣誉董事信息
- 用户需要达到六星会员，且直推3个六星、团队10个六星才能晋升为荣誉董事
- 荣誉董事可以享受每周分红

---

## 25. user_bankcards（用户银行卡表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `bank_name` - VARCHAR(50) NOT NULL（银行名称）
- `bank_account` - VARCHAR(30) NOT NULL（银行卡号）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user_card` (user_id, bank_account)

**外键：**
- `fk_user_bankcard`: user_id → users(id)

**说明：**
- 此表用于存储用户绑定的银行卡信息
- 同一用户不能绑定重复的银行卡号

---

## 26. wx_applyment（微信进件主申请表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（商家用户ID，关联 users.id）
- `business_code` - VARCHAR(124) NOT NULL UNIQUE（业务申请编号，唯一）
- `applyment_id` - BIGINT UNSIGNED NULL（微信支付申请单号）
- `sub_mchid` - VARCHAR(32) NULL（特约商户号）
- `subject_type` - ENUM('SUBJECT_TYPE_INDIVIDUAL','SUBJECT_TYPE_ENTERPRISE','SUBJECT_TYPE_INSTITUTIONS','SUBJECT_TYPE_OTHERS') NOT NULL（主体类型）
- `subject_info` - JSON NOT NULL（主体资料，含营业执照、法人信息等）
- `contact_info` - JSON NOT NULL（超级管理员信息）
- `bank_account_info` - JSON NOT NULL（结算账户信息）
- `applyment_state` - ENUM('APPLYMENT_STATE_EDITTING','APPLYMENT_STATE_AUDITING','APPLYMENT_STATE_REJECTED','APPLYMENT_STATE_TO_BE_CONFIRMED','APPLYMENT_STATE_TO_BE_SIGNED','APPLYMENT_STATE_SIGNING','APPLYMENT_STATE_FINISHED','APPLYMENT_STATE_CANCELED') NOT NULL DEFAULT 'APPLYMENT_STATE_EDITTING'（申请单状态）
- `applyment_state_msg` - VARCHAR(1024) NULL（状态描述）
- `sign_url` - VARCHAR(512) NULL（超管签约链接）
- `audit_detail` - JSON NULL（驳回详情，字段级错误数组）
- `is_draft` - TINYINT(1) NOT NULL DEFAULT 1（是否为草稿：1草稿/0已提交）
- `draft_expired_at` - DATETIME NULL（草稿过期时间，创建+7天）
- `is_core_info_modified` - TINYINT(1) NOT NULL DEFAULT 0（核心信息修改标记）
- `submitted_at` - DATETIME NULL（正式提交时间）
- `finished_at` - DATETIME NULL（完成时间）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）

**唯一键：**
- `uk_business_code` (business_code)

**索引：**
- `idx_user_id` (user_id)
- `idx_applyment_id` (applyment_id)
- `idx_sub_mchid` (sub_mchid)
- `idx_applyment_state` (applyment_state)

**说明：**
- 此表用于记录商家微信支付进件申请信息
- `business_code` 为服务商自定义的唯一业务编号，用于覆盖修改
- 进件成功后，`sub_mchid` 会回写到 `users.wechat_sub_mchid` 字段

---

## 27. wx_applyment_log（进件状态变更日志表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `applyment_id` - BIGINT UNSIGNED NOT NULL（关联微信申请单号）
- `business_code` - VARCHAR(124) NOT NULL（业务申请编号）
- `old_state` - VARCHAR(50) NOT NULL（变更前状态）
- `new_state` - VARCHAR(50) NOT NULL（变更后状态）
- `state_msg` - VARCHAR(1024) NULL（状态描述）
- `reject_detail` - JSON NULL（驳回详情）
- `operator` - VARCHAR(50) NULL（操作来源：SYSTEM/USER/WECHAT）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_applyment_id` (applyment_id)
- `idx_business_code` (business_code)
- `idx_created_at` (created_at)

**说明：**
- 此表用于记录微信进件申请单的状态变更历史
- 每次状态变更都会记录一条日志，便于追溯和审计

---

## 28. wx_applyment_media（进件材料管理表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `applyment_id` - BIGINT UNSIGNED NULL（关联申请单ID，草稿时可为空）
- `user_id` - BIGINT UNSIGNED NOT NULL（上传用户ID，关联 users.id）
- `media_id` - VARCHAR(512) NULL（微信媒体ID，24小时有效）
- `media_type` - ENUM('id_card_front','id_card_back','business_license','bank_card','authorization_letter','store_entrance','indoor_pic','other') NOT NULL（材料类型）
- `file_path` - VARCHAR(500) NOT NULL（本地存储路径）
- `file_name` - VARCHAR(255) NOT NULL（原始文件名）
- `file_size` - INT NOT NULL（文件大小，字节）
- `sha256` - CHAR(64) NOT NULL（文件SHA256哈希）
- `mime_type` - VARCHAR(50) NOT NULL（MIME类型）
- `upload_status` - ENUM('local','uploaded','expired','rejected') NOT NULL DEFAULT 'local'（上传状态）
- `expires_at` - DATETIME NULL（media_id过期时间）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_applyment_id` (applyment_id)
- `idx_user_id` (user_id)
- `idx_media_id` (media_id)
- `idx_media_type` (media_type)

**说明：**
- 此表用于管理微信进件所需的上传材料
- 支持身份证正反面、营业执照、银行卡、授权书、门店照片等多种材料类型
- `media_id` 为微信返回的媒体标识，24小时有效

---

## 29. merchant_settlement_accounts（商家结算账户表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（商家用户ID，关联 users.id）
- `sub_mchid` - VARCHAR(32) NULL（特约商户号）
- `account_type` - ENUM('BANK_ACCOUNT_TYPE_PERSONAL','BANK_ACCOUNT_TYPE_CORPORATE') NOT NULL（账户类型：个人/企业）
- `account_bank` - VARCHAR(128) NOT NULL（开户银行）
- `bank_name` - VARCHAR(128) NULL（开户行全称，含支行）
- `bank_branch_id` - VARCHAR(128) NULL（开户行联行号）
- `bank_address_code` - VARCHAR(20) NOT NULL（开户银行地区码，6位数字码）
- `account_name_encrypted` - TEXT NOT NULL（开户名称，RSA加密+Base64）
- `account_number_encrypted` - TEXT NOT NULL（银行账号，RSA加密+Base64）
- `card_hash` VARCHAR(64) NULL COMMENT （卡号哈希（用于判重，加盐SHA256））
- `verify_result` - ENUM('VERIFY_SUCCESS','VERIFY_FAIL','VERIFYING') NOT NULL DEFAULT 'VERIFYING'（验证结果）
- `verify_fail_reason` - VARCHAR(1024) NULL（验证失败原因）
- `modify_application_no` VARCHAR(64) DEFAULT NULL COMMENT （改绑申请单号）
- `modify_fail_reason` VARCHAR(255) DEFAULT NULL COMMENT （改绑失败原因） 
- `new_account_number_encrypted` TEXT NULL COMMENT （改绑-新卡号(加密)）
- `new_bank_name` VARCHAR(128) NULL COMMENT （改绑-新开户行）
- `old_account_backup` JSON NULL COMMENT （改绑-旧卡备份{number,name,bank}）
- `is_default` - TINYINT(1) NOT NULL DEFAULT 1（是否默认账户：1默认）
- `status` - TINYINT(1) NOT NULL DEFAULT 1（账户状态：1启用/0禁用）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）
- `bind_at` - DATETIME NULL（绑定成功时间）

**索引：**
- `idx_user_id` (user_id)
- `idx_sub_mchid` (sub_mchid)
- `idx_verify_result` (verify_result)
- `idx_status` (status)

**唯一索引**
- `uk_card_hash` (card_hash)

**说明：**
- 此表用于存储商家结算账户信息
- 账户名和账号均采用RSA加密存储，保障敏感信息安全
- 支持账户验证状态跟踪，记录验证成功/失败时间及原因

---

## 30. merchant_realname_verification（商家实名认证表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL UNIQUE（商家用户ID，一个用户一条记录）
- `verification_type` - ENUM('individual','enterprise') NOT NULL（认证类型：个人/企业）
- `status` - ENUM('pending','auditing','approved','rejected') NOT NULL DEFAULT 'pending'（认证状态）
- `audit_remark` - TEXT NULL（审核备注/驳回原因）
- `real_name` - VARCHAR(100) NOT NULL（姓名/企业名称）
- `id_card_no_encrypted` - TEXT NULL（身份证号/统一社会信用代码，加密）
- `id_card_front_media_id` - VARCHAR(512) NULL（身份证正面media_id）
- `id_card_back_media_id` - VARCHAR(512) NULL（身份证反面media_id）
- `business_license_no` - VARCHAR(100) NULL（营业执照号，企业必填）
- `business_license_media_id` - VARCHAR(512) NULL（营业执照media_id）
- `legal_person_name` - VARCHAR(100) NULL（法人姓名，企业必填）
- `legal_person_id_no_encrypted` - TEXT NULL（法人身份证号，加密）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）
- `updated_at` - DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP（更新时间）
- `audited_at` - DATETIME NULL（审核时间）

**索引：**
- `idx_status` (status)

**说明：**
- 此表用于记录商家实名认证信息
- 支持个人和企业两种认证类型
- 身份证号、统一社会信用代码、法人身份证号等敏感信息均加密存储
- 每个用户只能有一条实名认证记录

---

## 31. user_bankcard_operations（用户银行卡操作日志表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `operation_type` - VARCHAR(50) NOT NULL（操作类型：bind/unbind/set_default/verify等）
- `target_id` - BIGINT UNSIGNED NULL（关联的银行卡ID，user_bankcards.id）
- `old_val` - JSON NULL（旧值，JSON格式）
- `new_val` - JSON NULL（新值，JSON格式）
- `remark` - TEXT NULL（操作详情）
- `admin_key` - VARCHAR(100) NULL（管理员标识）
- `ip_address` - VARCHAR(45) NULL（IP地址）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user_id` (user_id)
- `idx_operation_type` (operation_type)
- `idx_created_at` (created_at)

**说明：**
- 此表用于记录用户银行卡的所有操作日志
- 包括绑定、解绑、设置默认、验证等操作
- 记录操作前后的值变化，便于审计和问题追溯

---

## 32. director_dividends（荣誉董事分红明细表）

**字段列表：**
- `id` - BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY（主键）
- `user_id` - BIGINT UNSIGNED NOT NULL（用户ID）
- `period_date` - DATE NOT NULL（分红周期日期）
- `dividend_amount` - DECIMAL(14,4) NOT NULL（分红金额）
- `new_sales` - DECIMAL(14,4) NOT NULL DEFAULT 0.00（本期新业绩）
- `weight` - INT NOT NULL DEFAULT 1（权重，基于团队六星人数）
- `created_at` - DATETIME DEFAULT CURRENT_TIMESTAMP（创建时间）

**索引：**
- `idx_user_id` (user_id)
- `idx_period_date` (period_date)

**说明：**
- 此表用于记录荣誉董事每周分红明细
- 分红金额基于本周新业绩的2%加权池，按团队六星人数线性加权分配

---

## 总结

- **总表数：32 个**
- **主要业务模块：**
  - 用户模块：users, user_referrals, addresses, user_bankcards, user_bankcard_operations
  - 商品模块：products, product_attributes, product_skus, banner
  - 订单模块：orders, order_items, refunds, alert_order, cart
  - 财务模块：finance_accounts, account_flow, withdrawals, merchant_statement
  - 积分模块：points_log, weekly_subsidy_records
  - 奖励模块：pending_rewards, team_rewards
  - 优惠券模块：coupons
  - 董事模块：directors, director_dividends
  - 商家进件/实名模块：wx_applyment, wx_applyment_log, wx_applyment_media, merchant_settlement_accounts, merchant_realname_verification
  - 联创模块：user_unilevel
  - 系统配置模块：system_sentence

- **精度说明：**
  - 积分相关字段（member_points, merchant_points, change_amount, balance_after, points_before, points_deducted）支持小数点后4位精度
  - 专用点数字段（points联创星级、subsidy_points周补贴、team_reward_points团队奖励、referral_points推荐奖励、true_total_points真实总数）支持小数点后4位精度
  - 优惠券金额（coupons.amount, weekly_subsidy_records.subsidy_amount）支持小数点后4位精度
  - 其他金额字段通常为小数点后2位精度

- **重要变更：**
  - ✅ `order_split` 表已废弃，订单资金拆分记录统一使用 `account_flow` 表
  - ✅ `user_addresses` 表已统一为 `addresses` 表，订单系统和用户系统共享地址管理
  - ✅ `users` 表新增 `is_merchant` 字段，用于标识商家身份
  - ✅ `users` 表新增 `six_director` 和 `six_team` 字段，用于荣誉董事晋升判定
  - ✅ `account_flow` 表统一记录所有资金流水，包括订单拆分、退款回冲、商家结算等
  - ✅ `products` 表新增 `max_points_discount` 字段，支持积分抵扣上限设置
  - ✅ `product_skus` 表新增 `original_price` 字段，记录商品原价（市场价/划线价）
  - ✅ `product_skus` 表新增 `specifications` 字段，支持JSON格式存储商品规格（如颜色、尺码等）
  - ✅ `orders` 表新增 `delivery_way` 字段，支持配送方式选择（platform-平台配送/pickup-自提）
  - ✅ `orders` 表包含 `merchant_id` 字段，用于关联商家
  - ✅ `cart` 表新增 `sku_id` 字段，支持购物车关联商品SKU
  - ✅ `cart` 表新增 `specifications` 字段，支持JSON格式存储购物车商品规格
  - ✅ `cart` 表唯一键从 `uk_user_product (user_id, product_id)` 改为 `uk_user_product_sku (user_id, product_id, sku_id)`
  - ✅ `order_items` 表新增 `sku_id` 字段，支持订单明细关联商品SKU
  - ✅ `users` 表新增专用点数字段：`points`（联创星级专用点数）、`subsidy_points`（周补贴专用点数）、`team_reward_points`（团队奖励专用点数）、`referral_points`（推荐奖励专用点数）、`true_total_points`（四个点数真实总数）
  - ✅ `users` 表新增 `wechat_sub_mchid` 字段，用于存储微信特约商户号（进件成功后回写）
  - ✅ `orders` 表新增 `offline_order_flag` 字段，用于标识是否线下收银订单（0线上/1线下）
  - ✅ `orders` 表新增 `applyment_id` 字段，用于关联微信进件单ID（线下订单必填）
  - ✅ 新增 `wx_applyment` 表，用于微信支付进件申请管理
  - ✅ 新增 `wx_applyment_log` 表，用于记录进件状态变更历史
  - ✅ 新增 `wx_applyment_media` 表，用于管理进件所需的上传材料
  - ✅ 新增 `merchant_settlement_accounts` 表，用于存储商家结算账户信息（加密存储）
  - ✅ 新增 `merchant_realname_verification` 表，用于商家实名认证管理
  - ✅ 新增 `user_bankcards` 表，用于存储用户银行卡信息
  - ✅ 新增 `user_bankcard_operations` 表，用于记录银行卡操作日志
  - ✅ `finance_accounts` 表新增账户类型：微信进件手续费 (wx_applyment_fee)
  - ✅ `directors` 和 `director_dividends` 表已在 `database_setup.py` 中定义并会自动创建
